<!-- index.html -->
<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <title>Issue Items</title>
  <!-- Include your CSS and any other resources here -->
</head>
<body>
  <div class="container">
    <button class="return-btn" onclick="window.location.href='return.html'">Go to Return Page</button>
    <h2>Issue Items</h2>
    
    <!-- Form Fields -->
    <div class="form-group">
      <label for="skuNo">SKU No:</label>
      <input type="text" id="skuNo" placeholder="Scan or Enter SKU No." required>
    </div>
    <div class="form-group">
      <label for="skuName">SKU Name:</label>
      <input type="text" id="skuName" placeholder="Auto-filled" readonly>
    </div>
    <div class="form-group">
      <label for="quantity">Quantity:</label>
      <input type="number" id="quantity" placeholder="Enter quantity" required>
      <!-- Implement addAnother() function if needed -->
    </div>
    <div class="form-group">
      <label for="studentName">Student Name:</label>
      <input type="text" id="studentName" placeholder="Enter student name" required>
    </div>
    <div class="form-group">
      <label for="mobileNo">Mobile No:</label>
      <input type="text" id="mobileNo" placeholder="Enter mobile number" required>
    </div>
    <div class="form-group">
      <label for="remarks">Remarks:</label>
      <input type="text" id="remarks" placeholder="Enter remarks (optional)">
    </div>
    <div class="form-group">
      <button id="submitBtn" onclick="submitForm()">Submit</button>
    </div>
  </div>

  <!-- Include any additional HTML elements -->

  <script>
    // Fetch SKU Name when SKU No. is entered
    document.getElementById("skuNo").addEventListener("change", function() {
      const skuNo = this.value;

      if (!skuNo) {
        document.getElementById("skuName").value = "";
        return;
      }

      google.script.run.withSuccessHandler(function(result) {
        if (result.success) {
          document.getElementById("skuName").value = result.skuName;
        } else {
          alert("Error: " + result.message);
          document.getElementById("skuName").value = "";
        }
      }).fetchSKUName(skuNo);
    });

    // Submit form data to issue an item
    function submitForm() {
      const skuNo = document.getElementById("skuNo").value;
      const skuName = document.getElementById("skuName").value || "N/A";
      const quantity = document.getElementById("quantity").value;
      const studentName = document.getElementById("studentName").value;
      const mobileNo = document.getElementById("mobileNo").value;
      const remarks = document.getElementById("remarks").value || "N/A";

      if (!skuNo || !quantity || !studentName || !mobileNo) {
        alert("Please fill in all required fields.");
        return;
      }

      const data = {
        skuNo,
        skuName,
        quantity: parseInt(quantity, 10),
        studentName,
        mobileNo,
        remarks
      };

      google.script.run.withSuccessHandler(function(result) {
        if (result.success) {
          alert(result.message);
          // Reset form fields
          document.getElementById("skuNo").value = "";
          document.getElementById("skuName").value = "";
          document.getElementById("quantity").value = "";
          document.getElementById("studentName").value = "";
          document.getElementById("mobileNo").value = "";
          document.getElementById("remarks").value = "";
        } else {
          alert("Error: " + result.message);
        }
      }).issueItem(data);
    }
  </script>
</body>
</html>